<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>ã‚«ã‚¹ãƒãƒ©å¯¾ç­–è¨ºæ–­</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; }
    h2 { text-align: center; color: #00b900; }
    .card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .question { font-weight: bold; margin-bottom: 10px; display: block; }
    .btn { background-color: #06c755; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
    .btn:disabled { background-color: #ccc; }
    #status { text-align: center; margin-top: 10px; font-size: 12px; color: #666; }
    select { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>ğŸ›¡ï¸ ã‚«ã‚¹ãƒãƒ©å¯¾ç­–ãƒã‚§ãƒƒã‚¯</h2>
  <div id="form-container">
    <div class="card">
      <span class="question">ã‚ãªãŸã®ç«‹å ´ã‚’é¸æŠã—ã¦ãã ã•ã„</span>
      <select id="role">
        <option value="çµŒå–¶è€…">çµŒå–¶è€…ãƒ»ç®¡ç†è€…</option>
        <option value="ã‚¹ã‚¿ãƒƒãƒ•">ã‚¹ã‚¿ãƒƒãƒ•ãƒ»è·å“¡</option>
      </select>
    </div>
    <div id="questions-area"></div>
    <button id="submit-btn" class="btn" onclick="submitForm()">è¨ºæ–­ã—ã¦AIã«ç›¸è«‡ã™ã‚‹</button>
  </div>
  <p id="status">LINEãƒ­ã‚°ã‚¤ãƒ³ä¸­...</p>

  <script>
    // â–¼â–¼ ã“ã“è¨­å®š â–¼â–¼
    const MY_LIFF_ID = '2008705180-p9GbufqO'; 
    const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbzxCmKqDptziWA0EkRSq45qDkEy9a7F64qXEYqZJgMdnExUfpYp_8vaXmm7aj1OxIcR-A/exec'; // ã•ã£ãã‚³ãƒ”ãƒ¼ã—ãŸGASã®URL

    const questions = [
      "â‘ ã‚«ã‚¹ãƒãƒ©å¯¾ç­–ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
      "â‘¡å…¥è·æ™‚ã«å¯¾ç­–ã‚’æ•™ãˆã¦ã¾ã™ã‹ï¼Ÿ",
      "â‘¢ã‚«ã‚¹ãƒãƒ©å¯¾ç­–ç ”ä¿®ã—ã¦ã¾ã™ã‹ï¼Ÿ",
      "â‘£ã‚«ã‚¹ãƒãƒ©å¯¾ç­–ç ”ä¿®ã€éå¸¸å‹¤è·å“¡å«ã‚€å…¨è·å“¡å—è¬›ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
      "â‘¤ã‚«ã‚¹ãƒãƒ©å¯¾ç­–ã‚°ãƒƒã‚ºã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
      "â‘¥ã‚«ã‚¹ãƒãƒ©ç›¸è«‡çª“å£ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
      "â‘¦ã‚«ã‚¹ãƒãƒ©ã®å®šç¾©ãŒè¨€ãˆã¾ã™ã‹ï¼Ÿ",
      "â‘§ã‚«ã‚¹ãƒãƒ©ã«é–¢ã™ã‚‹ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¯ã—ã¦ã¾ã™ã‹ï¼Ÿ",
      "â‘¨ã‚«ã‚¹ãƒãƒ©å¯¾ç­–ã‚’å®šæœŸçš„ã«è¦‹ç›´ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
      "â‘©ã‚«ã‚¹ãƒãƒ©ã‚’ã—ã¦ãã‚‹åˆ©ç”¨è€…å®¶æ—ã«æ›¸é¢ãªã©ã§æ³¨æ„ã‚’ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ"
    ];

    window.onload = function() {
      const area = document.getElementById('questions-area');
      questions.forEach((q, index) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <span class="question">${q}</span>
          <div class="options">
            <label><input type="radio" name="q${index}" value="Yes"> Yes</label>
            <label><input type="radio" name="q${index}" value="No"> No</label>
          </div>
        `;
        area.appendChild(div);
      });
      initializeLiff(MY_LIFF_ID);
    };

    function initializeLiff(liffId) {
      liff.init({ liffId: liffId })
        .then(() => {
          if (!liff.isLoggedIn()) {
            liff.login();
          } else {
            document.getElementById('status').innerText = "æº–å‚™å®Œäº†";
          }
        })
        .catch((err) => {
          document.getElementById('status').innerText = "ã‚¨ãƒ©ãƒ¼: " + err;
        });
    }

    function submitForm() {
      if (!liff.isLoggedIn()) { liff.login(); return; }

      const role = document.getElementById('role').value;
      const answers = [];
      // (çœç•¥ï¼šå›ç­”å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã¯åŒã˜ãªã®ã§ãã®ã¾ã¾)
      for (let i = 0; i < questions.length; i++) {
        const radios = document.getElementsByName(`q${i}`);
        let val = null;
        for (const r of radios) { if (r.checked) val = r.value; }
        if (!val) { alert("å…¨ã¦å›ç­”ã—ã¦ãã ã•ã„"); return; }
        answers.push({ question: questions[i], value: val });
      }

      const btn = document.getElementById('submit-btn');
      btn.disabled = true;
      btn.innerText = "é€ä¿¡ä¸­...";

      liff.getProfile().then(profile => {
        // GASã¸é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆï¼ˆJSONå½¢å¼ï¼‰
        // â€»GASã®doPostã¯é€šå¸¸ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã‚’æœŸå¾…ã—ã¾ã™ãŒã€
        // æ—¢å­˜ã®doPostãŒLINEã®Webhookå½¢å¼ã‚’å‰æã«ã—ã¦ã„ã‚‹ãŸã‚ã€
        // ä»Šå›ã¯è¨ºæ–­å°‚ç”¨ã®ãƒ•ãƒ©ã‚°ã‚’ã¤ã‘ã¦é€ã‚Šã¾ã™ã€‚
        
        const postData = {
          mode: "diagnosis", // è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰
          userId: profile.userId,
          role: role,
          answers: answers
        };

        // fetchã‚’ä½¿ã£ã¦GASã«é€ä¿¡ï¼
        fetch(GAS_API_URL, {
          method: 'POST',
          mode: 'no-cors', // é‡è¦: GASã¸ã®POSTã¯no-cors
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(postData)
        })
        .then(() => {
          // no-corsãªã®ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¸­èº«ã¯è¦‹ã‚Œã¾ã›ã‚“ãŒã€é€ä¿¡æˆåŠŸã¨ã¿ãªã—ã¦é–‰ã˜ã‚‹
          alert("è¨ºæ–­ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸï¼LINEã«çµæœãŒå±Šãã¾ã§ãŠå¾…ã¡ä¸‹ã•ã„ã€‚");
          liff.closeWindow();
        })
        .catch(err => {
          alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼: " + err);
          btn.disabled = false;
        });
      });
    }
  </script>
</body>
</html>
